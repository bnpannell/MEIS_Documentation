<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Section 6 Methods | California Military Economic Impact Study Process Guide</title>
  <meta name="description" content="This GitBook explains the process used to develop the 2020 California Military Economic Impact Study." />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="Section 6 Methods | California Military Economic Impact Study Process Guide" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This GitBook explains the process used to develop the 2020 California Military Economic Impact Study." />
  <meta name="github-repo" content="bnpannell/MEIS_Documentation" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Section 6 Methods | California Military Economic Impact Study Process Guide" />
  
  <meta name="twitter:description" content="This GitBook explains the process used to develop the 2020 California Military Economic Impact Study." />
  

<meta name="author" content="Britnee Pannell &amp; Sumeet Bedi" />


<meta name="date" content="2022-01-21" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="data-dictionary-for-repository.html"/>
<link rel="next" href="using-implan.html"/>
<script src="libs/header-attrs-2.11/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>



<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">California MEIS Process Guide</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a></li>
<li class="chapter" data-level="2" data-path="software-requirements.html"><a href="software-requirements.html"><i class="fa fa-check"></i><b>2</b> Software Requirements</a>
<ul>
<li class="chapter" data-level="2.1" data-path="software-requirements.html"><a href="software-requirements.html#download-necessary-r-packages"><i class="fa fa-check"></i><b>2.1</b> Download Necessary R Packages</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="data-requirements.html"><a href="data-requirements.html"><i class="fa fa-check"></i><b>3</b> Data Requirements</a>
<ul>
<li class="chapter" data-level="3.1" data-path="data-requirements.html"><a href="data-requirements.html#employment-data"><i class="fa fa-check"></i><b>3.1</b> Employment Data</a></li>
<li class="chapter" data-level="3.2" data-path="data-requirements.html"><a href="data-requirements.html#usaspending-data"><i class="fa fa-check"></i><b>3.2</b> USASpending Data</a></li>
<li class="chapter" data-level="3.3" data-path="data-requirements.html"><a href="data-requirements.html#additional-data"><i class="fa fa-check"></i><b>3.3</b> Additional Data</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="data-requirements.html"><a href="data-requirements.html#smartpay-data-via-foia"><i class="fa fa-check"></i><b>3.3.1</b> SmartPay Data via FOIA</a></li>
<li class="chapter" data-level="3.3.2" data-path="data-requirements.html"><a href="data-requirements.html#data-obtained-online"><i class="fa fa-check"></i><b>3.3.2</b> Data Obtained Online</a></li>
<li class="chapter" data-level="3.3.3" data-path="data-requirements.html"><a href="data-requirements.html#data-provided-rawself-made"><i class="fa fa-check"></i><b>3.3.3</b> Data Provided Raw/Self-Made</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="setting-up-the-repository.html"><a href="setting-up-the-repository.html"><i class="fa fa-check"></i><b>4</b> Setting Up the Repository</a>
<ul>
<li class="chapter" data-level="4.1" data-path="setting-up-the-repository.html"><a href="setting-up-the-repository.html#obtain-repository"><i class="fa fa-check"></i><b>4.1</b> Obtain Repository</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="data-dictionary-for-repository.html"><a href="data-dictionary-for-repository.html"><i class="fa fa-check"></i><b>5</b> Data Dictionary for Repository</a></li>
<li class="chapter" data-level="6" data-path="methods.html"><a href="methods.html"><i class="fa fa-check"></i><b>6</b> Methods</a>
<ul>
<li class="chapter" data-level="6.1" data-path="methods.html"><a href="methods.html#reviewing-the-parameters-file"><i class="fa fa-check"></i><b>6.1</b> Reviewing the Parameters File</a></li>
<li class="chapter" data-level="6.2" data-path="methods.html"><a href="methods.html#making-user-specific-data-files"><i class="fa fa-check"></i><b>6.2</b> Making User Specific Data Files</a></li>
<li class="chapter" data-level="6.3" data-path="methods.html"><a href="methods.html#processing-the-data"><i class="fa fa-check"></i><b>6.3</b> Processing the Data</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="methods.html"><a href="methods.html#step-1-clearing-environment-and-loading-in-packages-and-parameters"><i class="fa fa-check"></i><b>6.3.1</b> Step 1: Clearing Environment, and Loading in Packages and Parameters</a></li>
<li class="chapter" data-level="6.3.2" data-path="methods.html"><a href="methods.html#step-2-loading-in-functions"><i class="fa fa-check"></i><b>6.3.2</b> Step 2: Loading in Functions</a></li>
<li class="chapter" data-level="6.3.3" data-path="methods.html"><a href="methods.html#step-3-filtering-the-usaspending-data"><i class="fa fa-check"></i><b>6.3.3</b> Step 3: Filtering the USAspending Data</a></li>
<li class="chapter" data-level="6.3.4" data-path="methods.html"><a href="methods.html#step-4-error-checking-the-usaspending-data"><i class="fa fa-check"></i><b>6.3.4</b> Step 4: Error checking the USAspending Data</a></li>
<li class="chapter" data-level="6.3.5" data-path="methods.html"><a href="methods.html#step-5-concatenating-the-usaspending-data"><i class="fa fa-check"></i><b>6.3.5</b> Step 5: Concatenating the USAspending Data</a></li>
<li class="chapter" data-level="6.3.6" data-path="methods.html"><a href="methods.html#step-6-splitting-doe-from-usaspending-data"><i class="fa fa-check"></i><b>6.3.6</b> Step 6: Splitting DOE from USAspending Data</a></li>
<li class="chapter" data-level="6.3.7" data-path="methods.html"><a href="methods.html#step-7-aggregating-the-spending-data-for-statewide-numbers"><i class="fa fa-check"></i><b>6.3.7</b> Step 7: Aggregating the spending Data for Statewide Numbers</a></li>
<li class="chapter" data-level="6.3.8" data-path="methods.html"><a href="methods.html#step-8-compiling-employment-data"><i class="fa fa-check"></i><b>6.3.8</b> Step 8: Compiling Employment Data</a></li>
<li class="chapter" data-level="6.3.9" data-path="methods.html"><a href="methods.html#step-9-running-for-loops-to-generate-implan-activity-sheets"><i class="fa fa-check"></i><b>6.3.9</b> Step 9: Running For Loops to Generate IMPLAN Activity Sheets</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="using-implan.html"><a href="using-implan.html"><i class="fa fa-check"></i><b>7</b> Using IMPLAN</a></li>
<li class="chapter" data-level="8" data-path="conclusion-discussion.html"><a href="conclusion-discussion.html"><i class="fa fa-check"></i><b>8</b> Conclusion/ Discussion</a></li>
<li class="chapter" data-level="9" data-path="whats-next.html"><a href="whats-next.html"><i class="fa fa-check"></i><b>9</b> What’s Next?</a></li>
<li class="chapter" data-level="10" data-path="license-your-gitbook.html"><a href="license-your-gitbook.html"><i class="fa fa-check"></i><b>10</b> License your GitBook</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">California Military Economic Impact Study Process Guide</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="methods" class="section level1" number="6">
<h1><span class="header-section-number">Section 6</span> Methods</h1>
<p>The following section details how to use the data and R code provided as well as an explanation of how the code works.</p>
<div id="reviewing-the-parameters-file" class="section level2" number="6.1">
<h2><span class="header-section-number">6.1</span> Reviewing the Parameters File</h2>
<p>The first step in working with this code involves looking at the Parameters file. This file allows for alterations in the data analysis based on particular criteria that one may want to modify in their study, such as geography of interest, year, agencies of interest, and so forth. The default entries in the parameters file are based on this study of California.</p>
<p><em>Readme will eventually link to this section</em></p>
</div>
<div id="making-user-specific-data-files" class="section level2" number="6.2">
<h2><span class="header-section-number">6.2</span> Making User Specific Data Files</h2>
<p>Edit framework files in raw data of repo and move into appropriate section of repo.</p>
<p>Here is where you obtain your employment data and make the region specific file to read in those numbers (if we don’t just put them in the parameters file?)</p>
</div>
<div id="processing-the-data" class="section level2" number="6.3">
<h2><span class="header-section-number">6.3</span> Processing the Data</h2>
<p>After modifying the parameter files with the appropriate criteria and creating user specific data, one can begin working through the code to process the data and prepare it for IMPLAN. Refer to the deprecated_run_analysis_master.R script to run through the data analysis process for this project.</p>
<div id="step-1-clearing-environment-and-loading-in-packages-and-parameters" class="section level3" number="6.3.1">
<h3><span class="header-section-number">6.3.1</span> Step 1: Clearing Environment, and Loading in Packages and Parameters</h3>
<p>The first lines of code provide some housekeeping steps prior to running through the analysis. Line 4 allows the user to clear their global environment in RStudio, removing all previously defined or loaded packages, variables, values, etc. In running through the analysis wholesale, a good first step is to clear one’s environment. Following this is lines 7-12, which load in the various RStudio library packages that are needed to perform this analysis. For more information on these packages, please refer to our References section (“ADD IN LINK TO REFERENCES AND/OR R PACKAGE DESCRIPTIONS”). The final housekeeping step involves line 15, which loads in the parameters file mentioned above.</p>
</div>
<div id="step-2-loading-in-functions" class="section level3" number="6.3.2">
<h3><span class="header-section-number">6.3.2</span> Step 2: Loading in Functions</h3>
<p>Lines 19-23 compose the second step of the data analysis process: loading in functions that standardize and simplify working through the data. Line 19 loads in a R script that performs a call to USAspending.gov’s API in order to grab the relevant contract, grant, and direct payment spending data that we need for our analysis and download it into 2 files (1 for contracts, and 1 for grants/direct payments) at a specified file path location. In this case, the 2 CSV files obtained are downloaded into the data/temp folder. The parameters file is particularly important for this line of code, as the parameters file holds many of the filters that are used to sort what data is obtained from USAspending with this function. Line 20 loads in a function that is used to place additional filters on the obtained USAspending data and write the filtered data into CSV files. These additional filters are also outlined in the parameters file, but the actual filter function is not run until lines 26-30 (see step 3 for more details).</p>
<p>Line 21 loads in a function that concatenates the USAspending contract and grant data files into one dataframe in R, while also removing direct payments from that concatenation (as it is calculated separate from contracts and grants. more on this will be detailed below). The actual concatenate function is not run until lines 39 and 41 (see step 5 for more details). Line 22 loads in a function that splits out the concatenated USAspending dataframe by agency, taking out DOE data from the main dataframe. This is done because DOE’s spending activity has been kept separate from the main data analysis of the project. The actual split function is not run until lines 44-47 (see step 6 for more details). Line 23 loads in a function that aggregates the USAspending and DOEspending dataframes by IMPLAN sector. This gets the contracts and grants spending data for 2 IMPLAN activity sheets complete: 1 for the main statewide analysis, and 1 for the DOE statewide analysis. The actual aggregate function is not run until lines 55-60 (see step 7 for more details).</p>
</div>
<div id="step-3-filtering-the-usaspending-data" class="section level3" number="6.3.3">
<h3><span class="header-section-number">6.3.3</span> Step 3: Filtering the USAspending Data</h3>
<p>Lines 26-30 begin the third step of filtering down the USAspending data obtained from the API call. Lines 26 and 27 read in the downloaded contracts and grants/direct payments files (respectively) and assign them each to a variable. Lines 29 and 30 perform the filter_usaspending function (that was loaded in at line 20) on each of those variables.</p>
<p>The filter_usaspending function has five elements that must be referenced: file_name, state, doe_filters, filters, and out_name.</p>
<ul>
<li>The <strong>file_name</strong> element is a call to whichever data file we want to pass through to be filtered - in this case, the 2 USAspending CSVs that are defined in lines 26 and 27.</li>
<li>The <strong>state</strong> element is defined in our parameters, based on the state of interest for our study. In this case, that state is California. This element is added to ensure that the primary_place_of_performance_state is the same as the recipient_state (which was filtered in our obtain_usaspending function), thus ensuring that all data entries included in the analysis are in the state of interest for the study.</li>
<li>The <strong>doe_filters</strong> element is defined in our parameters, based on <strong>doe_offices</strong>. This element is included to filter out DOE spending done in the state that is not national security-related. The basis for this filter element is from a list of DOE sub-agencies that were demarcated as national security-related.</li>
<li>The <strong>filters</strong> element is defined in our parameters, based on <strong>contract_columns</strong> and <strong>grant_columns</strong>, respectively. This element is included to pare down the columns of data from the USAspending files to retain only the pertinent columns of data for our analysis.</li>
<li>The <strong>out_name</strong> element is defined in our parameters, based on <strong>c_out_name</strong> and <strong>g_out_name</strong>, respectively. This element is included to give a naming convention for the files that get generated as a result of running the filter function.</li>
</ul>
<p>After running the filter functions, 2 CSVs files should be generated in the data/temp folder, by the name defined from the <strong>out_name</strong> element.</p>
</div>
<div id="step-4-error-checking-the-usaspending-data" class="section level3" number="6.3.4">
<h3><span class="header-section-number">6.3.4</span> Step 4: Error checking the USAspending Data</h3>
<p>Lines 34-35 begin the fourth step of checking for errors in the filtered USAspending data and fixing them. The process for error checking and fixing the data differs for contracts and grants.</p>
<div id="error-checking-usaspending-contracts" class="section level4" number="6.3.4.1">
<h4><span class="header-section-number">6.3.4.1</span> Error Checking USAspending Contracts</h4>
<p>Line 34</p>
</div>
<div id="error-checking-usaspending-grants" class="section level4" number="6.3.4.2">
<h4><span class="header-section-number">6.3.4.2</span> Error Checking USAspending Grants</h4>
<p>Line 35</p>
</div>
</div>
<div id="step-5-concatenating-the-usaspending-data" class="section level3" number="6.3.5">
<h3><span class="header-section-number">6.3.5</span> Step 5: Concatenating the USAspending Data</h3>
<p>Lines 39 and 41</p>
</div>
<div id="step-6-splitting-doe-from-usaspending-data" class="section level3" number="6.3.6">
<h3><span class="header-section-number">6.3.6</span> Step 6: Splitting DOE from USAspending Data</h3>
<p>Lines 45, 47, and 48</p>
</div>
<div id="step-7-aggregating-the-spending-data-for-statewide-numbers" class="section level3" number="6.3.7">
<h3><span class="header-section-number">6.3.7</span> Step 7: Aggregating the spending Data for Statewide Numbers</h3>
<p>Lines 55-56 and 58-60</p>
</div>
<div id="step-8-compiling-employment-data" class="section level3" number="6.3.8">
<h3><span class="header-section-number">6.3.8</span> Step 8: Compiling Employment Data</h3>
<p>Lines ??-??</p>
</div>
<div id="step-9-running-for-loops-to-generate-implan-activity-sheets" class="section level3" number="6.3.9">
<h3><span class="header-section-number">6.3.9</span> Step 9: Running For Loops to Generate IMPLAN Activity Sheets</h3>
<p>Line ??</p>
<ul>
<li><p>Process data</p>
<ul>
<li>Clean contracts and grant data-</li>
<li>Clean spending data</li>
<li>Error check contract spending data</li>
</ul>
<p>Will need to go into detail about changes in the code between this year (2021) and subsequent years</p>
<p>More detailed mention of how the error checking of the USASpending.gov contract data is needed
A detailed walk through of how to manually check data and use the multiple NAICS to IMPLAN crosswalks to catch data
Mention how IMPLAN automatically removes any codes having to do with construction so those have to be manually coded</p>
<p>Some errors occur due to the transaction not being given a NAICS code, those need to be manually fixed</p>
<p>Issues occur with NAICS codes that apply to multiple IMPLAN codes- give detailed explanation of how this was worked around and data was processed and added back to the main cleaned data.</p></li>
</ul>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="data-dictionary-for-repository.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="using-implan.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/bnpannell/MEIS_Documentation/methods.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["MEIS_process_guide.pdf"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
